<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thêm Content</title>
    <style>
      /* CSS để ẩn phần Feature hoặc Movie List tùy theo lựa chọn */
      .section {
        display: none;
      }

      #feature-section.active,
      #movie-list-section.active {
        display: block;
      }
/* Cấu trúc cơ bản */

body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    
    color: #333;
    
}
      
.add-content {
  margin-left: 25px;  /* Di chuyển tất cả phần tử con sang trái */
 
}

.add-content * {
  margin-left: 0;     /* Loại bỏ margin mặc định */
  padding: 0;         /* Loại bỏ padding mặc định */
}

/* Tiêu đề */
h1, h2, h3 {
    color: #3498db;
    margin-bottom: 15px;
}

/* Các phần tử form */
label {
    font-weight: bold;
    display: inline-block; /* Chỉnh label thành inline-block để gắn ngay với input */
    width: auto;  /* Tự động điều chỉnh chiều rộng của label */
    margin-right: 10px; /* Thêm khoảng cách nhỏ giữa label và input */
    color: #85C1E9;
}
      
      

input[type="text"],
input[type="url"],
textarea {
    width: calc(100% - 120px); /* Làm cho input gần với label */
    padding: 8px;
    margin-bottom: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 1rem;
  
}

textarea {
    resize: vertical;
    height: 90px;
}

button {
    padding: 8px 15px;
    background-color: #3498db;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.3s ease;
    margin-top: 10px;
}

button:hover {
    background-color: #2980b9;
}

/* Form, bảng và các container */
.section {
    
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

#order-content-section {
    
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

select {
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 1rem;
    margin-bottom: 8px;
}

#movie-list-table, #order-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  color: blue;
}

#movie-list-table th, #order-table th,
#movie-list-table td, #order-table td {
    padding: 8px;
    border: 1px solid #ccc;
    text-align: left;
}

#movie-list-table th, #order-table th {
    background-color: #3498db;
    color:  lightgreen;
}

.video-item {
    margin-bottom: 15px;
}

.video-details {
    margin-top: 8px;
    background-color: #f9f9f9;
    padding: 8px;
    border-radius: 5px;
}

.toggle-details {
    margin-top: 8px;
    background-color: #f39c12;
    color: white;
    border: none;
    padding: 6px 8px;
    border-radius: 5px;
    cursor: pointer;
    margin-left: 50px; /* Di chuyển toggle details sang trái 50px */
}

.toggle-details:hover {
    background-color: #e67e22;
}

/* Responsive design */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }

    h1 {
        font-size: 1.8rem;
        text-align: center;
    }

    .section {
        padding: 12px;
    }

    input[type="text"],
    input[type="url"],
    textarea,
    select {
        width: 100%;
        font-size: 0.9rem;
    }

    button {
        width: 100%;
    }

    #movie-list-table,
    #order-table {
        width: 100%;
        font-size: 0.9rem;
    }
}

/* Tạo hiệu ứng cho form khi tải */
input:focus,
textarea:focus,
select:focus {
    border-color: #3498db;
    outline: none;
}

input[type="text"]:disabled,
input[type="url"]:disabled,
textarea:disabled,
select:disabled {
    
}
/* Hiệu ứng nổi bật khi chọn hàng */
tr.highlight {
 
  border: 2px solid #007bff;  /* Viền xanh để làm nổi bật */
}

tr {
  transition: transform 0.3s ease; /* Thêm hiệu ứng chuyển động mượt mà khi thay đổi vị trí */
}

tr.moving {
  transition: transform 0.3s ease; /* Thêm hiệu ứng chuyển động cho hàng khi đổi vị trí */
}

    </style>
     

  </head>
  <body>
          <div class="navbar">
      <div class="navbar-container">
        <div class="logo-container">
          <h1 class="logo animated-title2">OChinChin</h1>
        </div>
        <div class="menu-container"></div>
<div class="profile-container">
  <img class="profile-picture" id="profilePicture"  alt="Profile Picture">
  
  <div class="profile-text-container" id="profileTextContainer">
    <span class="profile-text">Profile</span>
    <i class="fas fa-caret-down"></i>
  </div>
  
  <div id="dropdownMenu" style="display: none;">
    <div id="name">Name: <span id="loggedUserName"></span></div>
    <div id="email">Email: <span id="loggedUserEmail"></span></div>
    
    <div class="button-container">
      <button id="changeProfileButton">Change Profile</button> <!-- Thêm nút thay đổi -->
      <button id="authButton">Login</button> <!-- Nút sẽ thay đổi thành "Logout" khi người dùng đã đăng nhập -->
    </div>
  </div>
</div>
      <div class="toggle"></div>
      </div>
    </div>

    <div class="sidebar"></div>

  <div class="container">
    <div class="content-container" id="content-container">
<div class="add-content">
  
      
  <h1>Thêm Content</h1>

  <!-- Chọn loại nội dung -->
  <div>
    <label for="content-type">Chọn loại nội dung:</label>
    <select id="content-type">
      <option value="feature">Feature</option>
      <option value="movie-list">Movie List</option>
      <option value="order">Sắp xếp</option>
      <option value="delete">Delete-content</option>
    </select>
  </div>

  <!-- Bảng Feature -->
  <div id="feature-section" class="section">
    <h2>Feature</h2>
    <label for="select-feature">Chọn Feature:</label>
    <select id="select-feature">
      <!-- Tùy chọn sẽ được nạp từ file JSON có sẵn -->
    </select>
    <button id="load-feature">Tải Feature</button>

    <form id="new-feature-form">
      <label>Tên file Feature:</label><br />
      <input type="text" name="featureName" placeholder="feature-name" required /><br />
      <label>Title:</label><br />
      <input type="text" name="title" placeholder="Nhập Feature title" required /><br />
      <label>URL Video:</label><br />
      <input type="text" name="videoUrl" placeholder="Nhập URL video" required /><br />
      <label>URL hình nền:</label><br />
      <input type="text" name="backgroundUrl" placeholder="Nhập URL hình nền " required /><br />
      <label>URL hình Feature:</label><br />
      <input type="text" name="featuredImgUrl" placeholder="Nhập URL Feature" required /><br />
      <label>Mô tả:</label><br />
      <textarea name="featuredDesc" placeholder = "Nhập mô tả" required></textarea><br />
      <button type="submit">Lưu Feature</button>
    </form>
  </div>

<!-- Bảng Movie List -->
<div id="movie-list-section" class="section">
  <h2>Movie List</h2>
  <label for="select-movie-list">Chọn Movie List:</label>
  <select id="select-movie-list">
    <!-- Tùy chọn sẽ được nạp từ file JSON có sẵn -->
  </select>
  <button id="load-movie-list">Tải Movie List</button>

  <form id="new-movie-list-form">
    <label>Tên file Movie List:</label><br />
    <input type="text" name="movieListName" placeholder="movie-list-name" required /><br />
    <label>Tên danh sách Movie:</label><br />
    <input type="text" name="listName" placeholder = "Nhập tên danh sách Movie" required /><br />
    <div id="movies-container">
      <h4>Movie List:</h4>
      <button type="button" id="add-video">Thêm Movie</button>
      <div id="movie-list-table">
        <!-- Các mục video sẽ được thêm vào đây, tạo bảng nếu cần -->
      </div>
    </div>
    <button type="submit">Lưu Movie List</button>
  </form>
</div>

<div class="video-item" style= "display:none">
  <label>Tiêu đề video:</label><br />
  <input type="text" name="videoTitle" placeholder="Nhập tiêu đề video" required /><br />
  
  <button type="button" class="remove-video">Xóa Video</button>
  
  <button type="button" class="toggle-details">Hiện/Ẩn Chi Tiết</button>
  
  <!-- Phần nhập mô tả, URL thumbnail, URL video, sẽ ẩn mặc định -->
  <div class="video-details" style="display: none;">
    <label>Mô tả:</label><br />
    <textarea name="videoDescription" placeholder="Nhập mô tả video"></textarea><br />
    
    <label>URL Thumbnail:</label><br />
    <input type="url" name="videoThumbnail" placeholder="Nhập URL thumbnail" /><br />
    
    <label>URL Video:</label><br />
    <input type="url" name="videoUrl" placeholder="Nhập URL video" /><br />
  </div>
  <hr />
</div>


  <!-- Bảng Order Content -->
  <div id="order-content-section" style="display: none;">
    <h3>Order Content</h3>
    <table id="order-table">
      <thead>
        <tr>
          <th>Content</th>
          <th>Name</th>
        </tr>
      </thead>
      <tbody id="order-table-body">
        <!-- Các hàng dữ liệu sẽ được thêm bằng JavaScript -->
      </tbody>
    </table>
    <button id="save-order-btn">Lưu thứ tự</button>
  </div>

<!-- Phần xóa nội dung, ẩn đi ban đầu -->
<div id="delete-container" style="display: none;">
  <!-- Chọn loại nội dung cần xóa -->
  <div>
    <label for="delete-content-type">Chọn loại nội dung cần xóa:</label>
    <select id="delete-content-type">
      <option value="feature">Feature</option>
      <option value="movie-list">Movie List</option>
    </select>
  </div>

  <!-- Nhập tên file cần xóa -->
  <div>
    <label for="content-name">Nhập tên nội dung cần xóa:</label>
    <input type="text" id="content-name" placeholder="Nhập tên nội dung cần xóa" />
  </div>

  <button id="delete-content-btn">Xóa nội dung</button>

  <!-- Phần nhập mật khẩu ẩn đi ban đầu -->
  <div id="password-container" style="display: none;">
    <label for="password">Nhập mật khẩu:</label>
    <input type="password" id="password" placeholder="Nhập mật khẩu để xác nhận xóa" />
    <button id="confirm-delete-btn">Xác nhận xóa</button>
  </div>
</div>
    </div>
    </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>

    <script>
   document.addEventListener("DOMContentLoaded", () => {
      const contentTypeSelect = document.getElementById("content-type");
      const featureSection = document.getElementById("feature-section");
      const movieListSection = document.getElementById("movie-list-section");

      const selectMovieList = document.getElementById("select-movie-list");
      const selectFeature = document.getElementById("select-feature");

        // Đảm bảo 'content-type' có giá trị mặc định là 'feature'
        if (contentTypeSelect.value === "") {
          contentTypeSelect.value = "feature";
        }

        // Đảm bảo select-movie-list và select-feature có giá trị mặc định là 'new'
        selectMovieList.innerHTML = '<option value="new">New</option>';
        selectFeature.innerHTML = '<option value="new">New</option>';

     

      document.getElementById("content-type").addEventListener("change", (event) => {
        const selectedType = event.target.value;
        const orderSection = document.getElementById("order-content-section");

        if (selectedType === "order") {
          orderSection.style.display = "block";
          loadOrderContent(); // Gọi hàm loadOrderContent để tải dữ liệu vào bảng
        } else {
          orderSection.style.display = "none";
        }
      });

// Hàm tải dữ liệu vào bảng Order Content từ order.txt
function loadOrderContent() {
  fetch("/get-files-order")
    .then(response => response.json())
    .then(files => {
      const tbody = document.getElementById("order-table-body");
      tbody.innerHTML = ""; // Xóa các hàng cũ

      // Thêm hàng cho từng file từ order.txt vào bảng
      files.forEach(file => {
        const row = document.createElement("tr");
        row.draggable = true; // Cho phép kéo thả
        row.innerHTML = `
          <td>${file.content}</td>
          <td>${file.name}</td>
        `;
        tbody.appendChild(row);
      });

      addDragAndDropHandlers(); // Thêm chức năng kéo thả vào các hàng
    })
    .catch(error => console.error("Error:", error));
}

// Thêm sự kiện để đổi vị trí hàng khi nhấn
function addDragAndDropHandlers() {
  const rows = document.querySelectorAll("#order-table-body tr");
  rows.forEach(row => {
    row.addEventListener("click", rowClick);  // Thêm sự kiện click
  });
}

let draggedRow = null;  // Lưu hàng đang được chọn

// Khi nhấn vào một hàng
function rowClick(event) {
  const clickedRow = event.target.closest('tr');
  
  if (!draggedRow) {
    // Lưu hàng đầu tiên khi nhấn
    draggedRow = clickedRow;
    draggedRow.style.opacity = 0.5;  // Giảm độ mờ của hàng đang chọn
    draggedRow.classList.add('highlight');  // Thêm hiệu ứng nổi bật cho hàng đầu tiên
  } else if (draggedRow !== clickedRow) {
    // Khi nhấn vào hàng thứ 2, đổi vị trí nếu không phải hàng đầu tiên
    const tbody = draggedRow.parentNode;
    const rows = Array.from(tbody.children);
    
    // Xác định vị trí đúng cho hàng
    if (rows.indexOf(clickedRow) < rows.indexOf(draggedRow)) {
      tbody.insertBefore(draggedRow, clickedRow); // Di chuyển hàng lên trên
    } else {
      tbody.insertBefore(draggedRow, clickedRow.nextSibling); // Di chuyển hàng xuống dưới
    }

    // Sau khi di chuyển, thêm viền xanh cho hàng thứ 2 và ẩn viền xanh của hàng đầu tiên
    clickedRow.classList.add('highlight');  // Thêm viền xanh cho hàng thứ 2
    draggedRow.classList.remove('highlight');  // Ẩn viền xanh của hàng đầu tiên

    draggedRow.style.opacity = 1;  // Khôi phục độ mờ của hàng sau khi thay đổi
    
    // Ẩn viền xanh ngay lập tức sau khi đổi vị trí
    setTimeout(() => {
      clickedRow.classList.remove('highlight');  // Ẩn viền xanh sau khi đổi xong
    }, 200);  // Thời gian chờ 200ms trước khi ẩn viền xanh
     
    draggedRow = null;  // Đặt lại biến draggedRow sau khi hoàn thành
  }
}


document.getElementById("save-order-btn").addEventListener("click", () => {
  const filesOrder = Array.from(document.querySelectorAll("#order-table-body tr")).map(row => {
    return {
      content: row.cells[0].innerText,
      name: row.cells[1].innerText
    };
  });

  fetch("/save-file-order", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ order: filesOrder }),
  })
    .then(response => response.text())
    .then(data => {
      alert("Thứ tự đã được lưu thành công!");
      setTimeout(() => {
        location.reload();  // Tải lại trang
      }, 800); 
    })
    .catch(error => console.error("Error:", error));
});


     

// Tải danh sách các movie list từ server và thêm vào select
fetch("/movie-list")
  .then((response) => response.json())
  .then((data) => {
    data.forEach((movieListName) => {
      // Loại bỏ tiền tố 'm_' và phần mở rộng file
      const cleanedMovieName = movieListName.replace(/^m_/, '').replace(/\.[^/.]+$/, '');

      const option = document.createElement("option");
      option.value = cleanedMovieName;
      option.textContent = cleanedMovieName;
      selectMovieList.appendChild(option);
    });
  })
  .catch((error) =>
    console.error("Lỗi tải danh sách movie list:", error)
  );

// Tải danh sách các feature từ server và thêm vào select
fetch("/feature-list")
  .then((response) => response.json())
  .then((data) => {
    data.forEach((featureName) => {
      // Loại bỏ tiền tố 'f_' và phần mở rộng file
      const cleanedFeatureName = featureName.replace(/^f_/, '').replace(/\.[^/.]+$/, '');

      const option = document.createElement("option");
      option.value = cleanedFeatureName;
      option.textContent = cleanedFeatureName;
      selectFeature.appendChild(option);
    });
  })
  .catch((error) => console.error("Lỗi tải danh sách feature:", error));

        // Hiển thị phần được chọn ngay khi trang tải
        if (contentTypeSelect.value === "feature") {
          featureSection.classList.add("active");
          movieListSection.classList.remove("active");
        } else if (contentTypeSelect.value === "movie-list") {
          movieListSection.classList.add("active");
          featureSection.classList.remove("active");
        }

        // Xử lý sự kiện khi chọn loại nội dung
        contentTypeSelect.addEventListener("change", (event) => {
          const selectedType = event.target.value;

          // Ẩn cả hai phần trước
          featureSection.classList.remove("active");
          movieListSection.classList.remove("active");

          // Hiển thị phần được chọn
          if (selectedType === "feature") {
            featureSection.classList.add("active");
          } else if (selectedType === "movie-list") {
            movieListSection.classList.add("active");
          }
        });

document.getElementById("load-movie-list").addEventListener("click", () => {
  const selectMovieList = document.getElementById("select-movie-list");
  const selectedMovieList = selectMovieList.value;
  const moviesContainer = document.getElementById("movies-container");

  if (selectedMovieList === "new") {
    // Làm trống các ô nhập liệu trong Movie List mà không làm mất phần label
    document.querySelector("input[name='movieListName']").value = "";
    document.querySelector("input[name='listName']").value = "";

    // Xóa các video cũ trong container mà không xóa label
    const movieInputs = moviesContainer.querySelectorAll('.video-item');
    movieInputs.forEach(input => {
      input.querySelector('input').value = '';  // Chỉ xóa giá trị ô nhập video
      input.querySelector('textarea').value = ''; // Chỉ xóa mô tả video
      input.querySelector('.video-details').style.display = 'none'; // Ẩn chi tiết video
    });

    alert("Các ô Movie List đã được làm trống.");
  } else if (selectedMovieList) {
    // Thêm tiền tố 'm_' và phần mở rộng '.json' vào tên movie list
    const movieListNameWithPrefix = `m_${selectedMovieList}.json`;

    fetch(`/load-movie-list/${movieListNameWithPrefix}`)
      .then((response) => response.json())
      .then((movieList) => {
        // Cập nhật tên Movie List vào trường 'movieListName'
        document.querySelector("input[name='movieListName']").value = selectedMovieList;

        // Cập nhật tên danh sách vào trường 'listName'
        document.querySelector("input[name='listName']").value = movieList.listName;

        // Xóa các video cũ trong container mà không xóa label
        const movieInputs = moviesContainer.querySelectorAll('.video-item');
        movieInputs.forEach(input => {
          input.querySelector('input').value = '';  // Chỉ xóa giá trị URL video
          input.querySelector('textarea').value = ''; // Chỉ xóa mô tả video
          input.querySelector('.video-details').style.display = 'none'; // Ẩn chi tiết video
        });

        // Cập nhật danh sách video vào form từ movieList
        movieList.movies.forEach((movie) => {
          const videoContainer = document.createElement("div");
          videoContainer.classList.add('video-item');
          videoContainer.style.display = 'block'; // Hiển thị video mới
          videoContainer.innerHTML = `
            <label for="videoTitle">Tiêu đề video:</label><br />
            <input type="text" name="videoTitle" value="${movie.title}" placeholder="Nhập tiêu đề video" required /><br />
            
            <button type="button" class="remove-video">Xóa Video</button>
            
            <button type="button" class="toggle-details">Hiện/Ẩn Chi Tiết</button>
            
            <!-- Phần nhập mô tả, URL thumbnail, URL video, sẽ ẩn mặc định -->
            <div class="video-details" style="display: none;">
              <label for="videoDescription">Mô tả:</label><br />
              <textarea name="videoDescription" placeholder="Nhập mô tả video">${movie.description}</textarea><br />
              
              <label for="videoThumbnail">URL Thumbnail:</label><br />
              <input type="url" name="videoThumbnail" value="${movie.thumbnail}" placeholder="Nhập URL thumbnail" /><br />
              
              <label for="videoUrl">URL Video:</label><br />
              <input type="url" name="videoUrl" value="${movie.url}" placeholder="Nhập URL video" /><br />
            </div>
            <hr />
          `;
          // Thêm video vào bảng
          moviesContainer.appendChild(videoContainer);

          // Xử lý sự kiện xóa video
          videoContainer.querySelector(".remove-video").addEventListener("click", () => {
            videoContainer.remove();
          });

          // Lắng nghe sự kiện toggle chi tiết video
          videoContainer.querySelector(".toggle-details").addEventListener("click", function() {
            const details = videoContainer.querySelector(".video-details");
            details.style.display = (details.style.display === "none") ? "block" : "none";
          });
        });
      })
      .catch((error) => console.error("Lỗi tải Movie List:", error));
  } else {
    alert("Vui lòng chọn Movie List.");
  }
});

// Khi người dùng chọn một Feature, tải dữ liệu của Feature đó
document
  .getElementById("load-feature")
  .addEventListener("click", () => {
    const selectFeature = document.getElementById("select-feature");
    const selectedFeature = selectFeature.value;

    if (selectedFeature === "new") {
      // Làm trống các ô nhập liệu trong Feature
      document.querySelector("input[name='featureName']").value = "";
      document.querySelector("input[name='title']").value = "";
      document.querySelector("input[name='videoUrl']").value = "";
      document.querySelector("input[name='backgroundUrl']").value = "";
      document.querySelector("input[name='featuredImgUrl']").value = "";
      document.querySelector("textarea[name='featuredDesc']").value = "";
      alert("Các ô Feature đã được làm trống.");
    } else if (selectedFeature) {
      const featureWithPrefix = `f_${selectedFeature}.json`;

      // Tải dữ liệu từ server cho Feature đã chọn
      fetch(`/load-feature/${featureWithPrefix}`)
        .then((response) => response.json())
        .then((feature) => {
          // Cập nhật các trường trong form với dữ liệu từ feature
          document.querySelector("input[name='featureName']").value = selectedFeature;
          document.querySelector("input[name='title']").value = feature.title || "";
          document.querySelector("input[name='videoUrl']").value = feature.videoUrl || "";
          document.querySelector("input[name='backgroundUrl']").value = feature.backgroundUrl || "";
          document.querySelector("input[name='featuredImgUrl']").value = feature.featuredImgUrl || "";
          document.querySelector("textarea[name='featuredDesc']").value = feature.featuredDesc || "";
        })
        .catch((error) => console.error("Lỗi tải Feature:", error));
    } else {
      alert("Vui lòng chọn Feature.");
    }
  });

// Xử lý gửi form để lưu Feature mới
// Xử lý gửi form để lưu Feature mới
document
  .getElementById("new-feature-form")
  .addEventListener("submit", (event) => {
    event.preventDefault();

    // Thu thập dữ liệu từ form Feature
    const formData = new FormData(event.target);
    const featureData = Object.fromEntries(formData.entries());

    // Kiểm tra điều kiện tên Feature
    if (
      !featureData.featureName || // Kiểm tra trống
      /\s/.test(featureData.featureName) || // Kiểm tra khoảng trắng
      /[<>.:"/\\|?*\x00-\x1F]/.test(featureData.featureName) // Kiểm tra ký tự không hợp lệ
    ) {
      alert("Tên file feature không hợp lệ");
      return; // Dừng lại nếu tên không hợp lệ
    }
// Hàm kiểm tra và chuyển đổi URL thành thumbnail YouTube
function getYouTubeThumbnail(url) {
  const youtubePattern = /(?:youtube\.com\/(?:watch\?v=|embed\/|live\/|shorts\/|v\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
  const match = url.match(youtubePattern);
  return match ? `https://img.youtube.com/vi/${match[1]}/hqdefault.jpg` : url; // Nếu có video ID, trả về URL thumbnail, nếu không thì trả về URL gốc
}

// Kiểm tra và xử lý featuredImgUrl và backgroundUrl
if (featureData.featuredImgUrl) {
  featureData.featuredImgUrl = getYouTubeThumbnail(featureData.featuredImgUrl);
}

if (featureData.backgroundUrl) {
  featureData.backgroundUrl = getYouTubeThumbnail(featureData.backgroundUrl);
}

// if (featureData.videoUrl) {
//   // Kiểm tra nếu URL là của Pornhub (chấp nhận bất kỳ subdomain nào)
//   const pornhubRegEx = /^https:\/\/(?:[a-zA-Z0-9-]+\.)?pornhub\.com\/view_video\.php\?viewkey=([a-zA-Z0-9_-]+)/;
//   const pornhubMatch = featureData.videoUrl.match(pornhubRegEx);
  
//   if (pornhubMatch && pornhubMatch[1]) {
//     // Lấy viewkey từ URL Pornhub và tạo URL nhúng
//     const videoKey = pornhubMatch[1];
//     featureData.videoUrl = `https://www.pornhub.com/embed/${videoKey}`;
//   }
// }

    // Gửi dữ liệu Feature đến server
    fetch("/save-feature", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(featureData),
    })
      .then((response) => response.text())
      .then((data) => {
        alert(data); // Thông báo sau khi lưu thành công

        // Xóa nội dung của các trường input và textarea sau khi lưu thành công
        event.target.querySelectorAll("input[type='text'], textarea").forEach((input) => {
          input.value = "";
        });
      })
      .catch((error) => console.error("Lỗi lưu Feature:", error));
  });


// Xử lý gửi form để lưu Movie List mới
document
  .getElementById("new-movie-list-form")
  .addEventListener("submit", (event) => {
    event.preventDefault();

    // Thu thập dữ liệu từ form Movie List
    const formData = new FormData(event.target);
    const movieListData = Object.fromEntries(formData.entries());

    // Kiểm tra điều kiện tên Movie List
    if (
      !movieListData.movieListName || // Kiểm tra trống
      /\s/.test(movieListData.movieListName) || // Kiểm tra khoảng trắng
      /[<>.:"/\\|?*\x00-\x1F]/.test(movieListData.movieListName) // Kiểm tra ký tự không hợp lệ
    ) {
      alert("Tên file movie list không hợp lệ");
      return; // Dừng lại nếu tên không hợp lệ
    }

    // Thu thập tất cả URL video trong movies-container
    const movies = [];
    document.querySelectorAll("#movies-container .video-item").forEach((videoItem) => {
      const videoTitle = videoItem.querySelector("input[name='videoTitle']").value;
      let videoUrl = videoItem.querySelector("input[name='videoUrl']").value;
      let videoThumbnail = videoItem.querySelector("input[name='videoThumbnail']").value;
      const videoDescription = videoItem.querySelector("textarea[name='videoDescription']").value;

// Hàm kiểm tra và chuyển đổi URL thành thumbnail YouTube
function getYouTubeThumbnail(url) {
  const youtubePattern = /(?:youtube\.com\/(?:watch\?v=|embed\/|live\/|shorts\/|v\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
  const match = url.match(youtubePattern);
  return match ? `https://img.youtube.com/vi/${match[1]}/hqdefault.jpg` : url; // Nếu có video ID, trả về URL thumbnail, nếu không thì trả về URL gốc
}

// Kiểm tra và xử lý videoThumbnail nếu là URL YouTube
if (videoThumbnail) {
  videoThumbnail = getYouTubeThumbnail(videoThumbnail);
}

//             // Kiểm tra và xử lý videoUrl nếu là Pornhub
//       if (videoUrl) {
//         const pornhubRegEx = /^https:\/\/(?:[a-zA-Z0-9-]+\.)?pornhub\.com\/view_video\.php\?viewkey=([a-zA-Z0-9_-]+)/;
//         const pornhubMatch = videoUrl.match(pornhubRegEx);
        
//         if (pornhubMatch && pornhubMatch[1]) {
//           // Lấy viewkey từ URL Pornhub và tạo URL nhúng
//           const videoKey = pornhubMatch[1];
//           videoUrl = `https://www.pornhub.com/embed/${videoKey}`;  // Cập nhật URL nhúng
//         }
//       }

      // Đẩy các video vào mảng
      if (videoUrl) {
        movies.push({
          title: videoTitle,
          url: videoUrl,
          thumbnail: videoThumbnail,
          description: videoDescription
        });
      }
    });

    // Thêm mảng movies vào dữ liệu gửi lên
    movieListData.movies = movies;

    // Gửi dữ liệu Movie List đến server
    fetch("/save-movie-list", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(movieListData),
    })
      .then((response) => response.text())
      .then((data) => {
        alert(data); // Thông báo sau khi lưu thành công

        // Xóa nội dung của các trường input và textarea trong form Movie List
        event.target.querySelectorAll("input[type='text']").forEach((input) => {
          input.value = ""; 
        });
        event.target.querySelectorAll("textarea").forEach((textarea) => {
          textarea.value = "";
        });

        // Xóa tất cả các video items trong container
        const movieInputs = document.querySelectorAll("#movies-container .video-item");
        movieInputs.forEach((videoItem) => {
          videoItem.remove(); // Xóa hoàn toàn video item khỏi DOM
        });
      })
      .catch((error) => console.error("Error:", error));
  });


document.getElementById('add-video').addEventListener('click', function() {
  // Lấy mẫu video ẩn từ div video-item
  const videoTemplate = document.querySelector('.video-item');

  // Clone mẫu video ẩn để tạo video mới
  const videoContainer = videoTemplate.cloneNode(true);
  videoContainer.style.display = 'block'; // Hiển thị video mới
  
  // Làm trống dữ liệu của các trường trong video mới
  videoContainer.querySelector("input[name='videoTitle']").value = '';
  videoContainer.querySelector("input[name='videoUrl']").value = '';
  videoContainer.querySelector("input[name='videoThumbnail']").value = '';
  videoContainer.querySelector("textarea[name='videoDescription']").value = '';

  // Đảm bảo rằng chi tiết video được ẩn khi thêm video mới
  const details = videoContainer.querySelector('.video-details');
  details.style.display = 'none'; // Ẩn phần chi tiết của video mới

  // Thêm video vào cuối cùng của movies-container
  const moviesContainer = document.getElementById("movies-container");
  moviesContainer.appendChild(videoContainer);

  // Lắng nghe sự kiện xóa video
  videoContainer.querySelector('.remove-video').addEventListener('click', function() {
    videoContainer.remove();
  });

  // Lắng nghe sự kiện toggle chi tiết video
  videoContainer.querySelector('.toggle-details').addEventListener('click', function() {
    const details = videoContainer.querySelector('.video-details');
    details.style.display = (details.style.display === 'none') ? 'block' : 'none';
  });
});
// Lắng nghe khi người dùng thay đổi lựa chọn trong phần content-type
document.getElementById("content-type").addEventListener("change", function() {
  const contentType = this.value;
  
  // Kiểm tra nếu chọn "delete", hiển thị phần xóa nội dung
  if (contentType === "delete") {
    document.getElementById("delete-container").style.display = "block";  // Hiển thị phần xóa
  } else {
    document.getElementById("delete-container").style.display = "none";   // Ẩn phần xóa
  }
});

// Lắng nghe sự kiện nhấn nút "Xóa nội dung"
document.getElementById("delete-content-btn").addEventListener("click", function() {
  const contentType = document.getElementById("delete-content-type").value;
  const contentName = document.getElementById("content-name").value;

  // Kiểm tra xem tên nội dung đã nhập chưa
  if (!contentName) {
    alert("Vui lòng nhập tên nội dung cần xóa.");
    return;
  }

  // Hiển thị yêu cầu nhập mật khẩu
  document.getElementById("password-container").style.display = "block";
});

document.getElementById("confirm-delete-btn").addEventListener("click", function() {
  const password = document.getElementById("password").value;
  const contentType = document.getElementById("delete-content-type").value;
  const contentName = document.getElementById("content-name").value;

  // Gửi yêu cầu xóa file lên server
  const fileName = contentType === "feature" ? `f_${contentName}.json` : `m_${contentName}.json`;

  fetch("/delete-file", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      password: password,         // Mật khẩu
      content: contentType,       // Loại nội dung (feature/movie-list)
      name: contentName           // Tên file
    })
  })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert("Nội dung đã được xóa thành công.");

        // Reset lại các trường sau khi xóa thành công
        document.getElementById("content-name").value = "";  // Xóa tên nội dung
        document.getElementById("password").value = "";     // Xóa mật khẩu
        document.getElementById("delete-content-type").value = "feature";  // Reset loại nội dung về mặc định

        // Ẩn phần nhập mật khẩu sau khi xóa thành công
        document.getElementById("password-container").style.display = "none"; 
      } else {
        alert(data.message);  // Hiển thị thông báo lỗi từ server
      }
    })
    .catch(error => {
      console.error("Có lỗi xảy ra:", error);
      alert("Lỗi khi xóa nội dung.");
    });
});


const style = document.createElement('style');
style.textContent = `
  /* Đặt cho mọi ô nhập liệu và textarea */
  input[type="text"]:focus,
  textarea:focus {
    outline: 2px solid #007BFF;
  }

  /* Container để chứa nút Copy/Paste */
  .copy-paste-group {
    display: none; /* Mặc định ẩn nhóm nút */
    position: absolute; /* Đặt vị trí tuyệt đối */
    top: 100%; /* Đặt nút xuống phía dưới ô nhập liệu */
    left: 0;
    margin-top: 5px; /* Khoảng cách giữa ô nhập liệu và nút */
  }

  /* Cài đặt nút Copy/Paste */
  .copy-paste-group button {
    background-color: #007BFF;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 14px;
    border-radius: 4px;
    transition: background-color 0.3s ease;
  }

  .copy-paste-group button:hover {
    background-color: #0056b3;
  }
  /* Cài đặt chung cho tất cả cp-button */
cp-button {
  display: inline-block;
  background-color: #007BFF;
  color: white;
  border: none;
  padding: 5px 10px;
  cursor: pointer;
  font-size: 14px;
  border-radius: 4px;
  transition: background-color 0.3s ease;
  text-align: center;
  line-height: 1.5;
  user-select: none;
}

cp-button:hover {
  background-color: #0056b3;
}

cp-button:focus {
  outline: none; /* Xóa outline khi focus */
}



`;

document.head.appendChild(style);

// Tạo nhóm nút Copy/Paste cho một input
function addCopyPasteButtons(input) {
  // Tạo nhóm nút Copy/Paste
  const buttonGroup = document.createElement('div');
  buttonGroup.className = 'copy-paste-group';

  // Tạo nút Copy
  const copyBtn = document.createElement('cp-button');
  copyBtn.className = 'cp-button copy-btn'; // Đổi tên lớp thành 'cp-button copy-btn'
  copyBtn.textContent = 'Copy';
  buttonGroup.appendChild(copyBtn);

  // Tạo nút Paste
  const pasteBtn = document.createElement('cp-button');
  pasteBtn.className = 'cp-button paste-btn'; // Đổi tên lớp thành 'cp-button paste-btn'
  pasteBtn.textContent = 'Paste';
  buttonGroup.appendChild(pasteBtn);

  // Chèn nhóm nút vào phần tử chứa input/textarea
  input.parentElement.style.position = 'relative'; // Đặt position relative cho phần tử cha
  input.parentElement.appendChild(buttonGroup);

  // Hiển thị nhóm nút khi ô nhập liệu được focus
  input.addEventListener('focus', () => {
    buttonGroup.style.display = 'block'; // Hiển thị nhóm nút khi focus vào input
    updateButtonPosition(); // Cập nhật vị trí nút khi focus
  });

  // Cập nhật vị trí nút Copy/Paste mỗi khi người dùng gõ
  input.addEventListener('input', () => {
    updateButtonPosition();
  });

  // Xử lý sự kiện mousedown cho nút copy/paste để ngừng sự kiện blur
  copyBtn.addEventListener('mousedown', (event) => {
    event.stopPropagation(); // Ngừng sự kiện blur khi nhấn vào nút copy
  });

  pasteBtn.addEventListener('mousedown', (event) => {
    event.stopPropagation(); // Ngừng sự kiện blur khi nhấn vào nút paste
  });

  // Cập nhật vị trí của nút Copy/Paste
  function updateButtonPosition() {
    let topPosition = -260;  // Bắt đầu từ vị trí offsetTop của phần tử input
    let leftPosition = -70;  // Bắt đầu từ vị trí offsetLeft của phần tử input
    let currentElement = input;

    // Lặp qua các phần tử cha để tính toán offsetTop và offsetLeft
    while (currentElement) {
      topPosition += currentElement.offsetTop;  // Cộng dồn offsetTop của từng phần tử cha
      leftPosition += currentElement.offsetLeft;  // Cộng dồn offsetLeft của từng phần tử cha
      currentElement = currentElement.offsetParent;  // Chuyển đến phần tử cha tiếp theo
    }

    // Điều chỉnh để nhóm nút nằm ngay phía trên của ô nhập liệu
    buttonGroup.style.top = `${topPosition - buttonGroup.offsetHeight - 5}px`; // Nút ở phía trên ô input, cách 5px
    buttonGroup.style.left = `${leftPosition}px`; // Cập nhật vị trí left theo input

    // Đảm bảo rằng group button được căn chỉnh đúng
    buttonGroup.style.position = 'absolute'; // Đảm bảo group button có position absolute
  }

  // Khi ô nhập liệu được focus, chọn toàn bộ nội dung
  input.addEventListener('focus', () => {
    input.select(); // Chọn toàn bộ nội dung trong input
  });

  // Sự kiện Copy
  copyBtn.addEventListener('click', () => {
    input.select(); // Chọn toàn bộ nội dung trong input
    navigator.clipboard.writeText(input.value).then(() => {
      alert('Nội dung đã được copy!');
    }).catch(err => {
      console.error('Không thể copy:', err);
      alert('Không thể copy nội dung!');
    });
  });

  // Sự kiện Paste
  pasteBtn.addEventListener('click', async () => {
    try {
      const text = await navigator.clipboard.readText();  // Đọc nội dung từ clipboard
      input.value = text;  // Dán nội dung vào ô input
      alert('Đã paste nội dung!');
    } catch (err) {
      console.error('Không thể paste:', err);
      alert('Không thể dán nội dung!');
    }
  });

  // Ẩn nhóm nút sau 0.3 giây khi mất focus
  input.addEventListener('blur', () => {
    setTimeout(() => {
      buttonGroup.style.display = 'none'; // Ẩn nhóm nút sau 0.3 giây
    }, 300); // 0.3 giây (300ms)
  });

  // Cập nhật vị trí khi nút được thêm mới
  updateButtonPosition(); // Đảm bảo rằng nút Copy/Paste có vị trí đúng ngay từ đầu
}

// Áp dụng cho các input hiện tại
document.querySelectorAll('input[type="text"], textarea').forEach((input) => {
  addCopyPasteButtons(input);
});
// Quan sát sự thay đổi trong DOM để tự động thêm nút Copy/Paste cho các input mới
const observer = new MutationObserver((mutationsList) => {
  mutationsList.forEach((mutation) => {
    if (mutation.type === 'childList') {
      mutation.addedNodes.forEach((node) => {
        if (node.nodeType === 1) { // Kiểm tra nếu là phần tử HTML
          // Thêm nút Copy/Paste cho tất cả các input mới được thêm vào DOM
          node.querySelectorAll('input[type="text"], textarea').forEach((input) => {
            addCopyPasteButtons(input);
          });
        }
      });
    }
  });
});



// Thiết lập observer để theo dõi sự thay đổi trong DOM
observer.observe(document.body, {
  childList: true, // Quan sát thêm/xóa phần tử
  subtree: true,    // Quan sát toàn bộ cây DOM
});

      });
    </script>
      <script src="/script/app.js" defer></script>
      <script src="/script/animated.js" defer></script>
    <script type="module" src="/script/profile.js" defer></script>

  </body>
</html>
